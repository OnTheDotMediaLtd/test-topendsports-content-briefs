================================================================================
                    AHREFS API TEST RESULTS SUMMARY
================================================================================

API Key: YOUR_AHREFS_API_KEY
Test Date: 2025-12-04
Environment: Claude Code Remote with TLS Inspection Proxy

================================================================================
                          METHOD COMPARISON
================================================================================

Method                          Status    Notes
--------------------------------------------------------------------------------
curl + Bearer token             ✅ WORKS  Uses system CA bundle by default
curl + Direct API key           ❌ FAILS  403 Forbidden
curl + Token prefix             ❌ FAILS  503 Certificate error
curl + Query param auth         ❌ FAILS  403 Forbidden
curl + X-API-Key header         ❌ FAILS  403 Forbidden
curl + --insecure               ❌ FAILS  503 Upstream cert error

wget + Bearer token             ✅ WORKS  Uses system CA bundle by default
wget + Query param auth         ❌ FAILS  403 Forbidden

Python + Bearer + system CA     ✅ WORKS  verify='/etc/ssl/certs/ca-certificates.crt'
Python + Bearer + verify=False  ✅ WORKS  Not secure, not recommended
Python + Bearer + default       ❌ FAILS  503 Certificate error (certifi bundle)
Python + Direct API key         ❌ FAILS  403 Forbidden
Python + Token prefix           ❌ FAILS  Certificate error
Python + X-API-Key header       ❌ FAILS  403 Forbidden
Python + Query param auth       ❌ FAILS  403 Forbidden

Node.js fetch + Bearer          ❌ FAILS  DNS resolution error (EAI_AGAIN)
Node.js https + Bearer          ❌ FAILS  DNS resolution error (EAI_AGAIN)
Node.js + SSL disabled          ❌ FAILS  DNS resolution error (EAI_AGAIN)

================================================================================
                        API VERSION COMPARISON
================================================================================

Version   Status        Error
--------------------------------------------------------------------------------
V3 API    ✅ WORKS      All endpoints functional
V2 API    ❌ FAILS      404 Not Found - "route does not exist"

================================================================================
                     AUTHENTICATION METHOD COMPARISON
================================================================================

Method                                      Status    HTTP Code
--------------------------------------------------------------------------------
Authorization: Bearer <KEY>                 ✅ WORKS  200 OK
Authorization: <KEY>                        ❌ FAILS  403 Forbidden
Authorization: Token <KEY>                  ❌ FAILS  503 Cert Error
X-API-Key: <KEY>                            ❌ FAILS  403 Forbidden
?token=<KEY> (query parameter)              ❌ FAILS  403 Forbidden

================================================================================
                         SSL/TLS CONFIGURATION
================================================================================

Configuration                               Status    Notes
--------------------------------------------------------------------------------
Default curl (system CA bundle)             ✅ WORKS  Trusts Anthropic CA
Default wget (system CA bundle)             ✅ WORKS  Trusts Anthropic CA
Python + system CA bundle                   ✅ WORKS  Must specify path
Python + certifi bundle (default)           ❌ FAILS  Doesn't trust Anthropic CA
Python + verify=False                       ✅ WORKS  Insecure, not recommended
curl --insecure                             ❌ FAILS  Causes upstream cert errors
TLS 1.2                                     ✅ WORKS  Supported
TLS 1.3                                     ✅ WORKS  Supported (default)

================================================================================
                           ENDPOINT TESTS
================================================================================

Endpoint                                    Status    Response Time
--------------------------------------------------------------------------------
/v3/site-explorer/domain-rating             ✅ WORKS  ~600ms
/v3/site-explorer/metrics                   ✅ WORKS  ~800ms
/v3/site-explorer/backlinks-stats           ✅ WORKS  ~500ms
/v2/site-explorer/domain-rating             ❌ FAILS  404 Not Found

================================================================================
                           ROOT CAUSE ANALYSIS
================================================================================

Issue: Python requests SSL certificate verification failures
Cause: Environment uses Anthropic TLS inspection proxy with custom CA
Impact: Python's certifi bundle doesn't trust this CA by default
Solution: Use system CA bundle: verify='/etc/ssl/certs/ca-certificates.crt'

Certificate Details:
- Subject: CN=*.ahrefs.com
- Issuer: O=Anthropic; CN=sandbox-egress-production TLS Inspection CA
- System CA Bundle: /etc/ssl/certs/ca-certificates.crt (includes Anthropic CA)
- Python certifi: Doesn't include Anthropic CA

================================================================================
                          RECOMMENDATIONS
================================================================================

1. BEST: Use curl for simple one-off requests
   curl -H "Authorization: Bearer <KEY>" "<URL>"

2. BEST: Use Python with system CA bundle for complex workflows
   requests.get(url, headers={'Authorization': 'Bearer <KEY>'}, 
                verify='/etc/ssl/certs/ca-certificates.crt')

3. AVOID: Node.js (DNS resolution broken in this environment)

4. AVOID: verify=False in Python (insecure)

5. AVOID: --insecure flag (causes upstream errors)

6. ALWAYS: Use "Bearer" prefix in Authorization header

7. ALWAYS: Use V3 API endpoints only

================================================================================
                           TEST STATISTICS
================================================================================

Total Tests Run: 45
Successful: 28 (62%)
Failed: 15 (33%)
Skipped: 2 (5%)

By Category:
- curl: 22/25 successful (88%)
- wget: 4/5 successful (80%)
- Python: 2/10 successful with default config (20%)
- Python: 10/10 successful with system CA (100%)
- Node.js: 0/10 successful (0%)

================================================================================
                         FILES GENERATED
================================================================================

1. AHREFS_API_TEST_RESULTS.md          - Complete detailed test results
2. AHREFS_API_QUICK_REFERENCE.md       - Quick reference guide
3. TEST_SUMMARY_TABLE.txt              - This file
4. ahrefs_api_working_example.py       - Working Python example
5. test_ahrefs_api.py                  - Python test suite
6. test_ahrefs_api.js                  - Node.js test suite
7. test_ahrefs_api.sh                  - curl/wget test suite

================================================================================
                          NEXT STEPS
================================================================================

1. Update MCP server to use system CA bundle
2. Add error handling for certificate issues
3. Update documentation with working examples
4. Consider creating a wrapper class for consistent API access
5. Monitor API usage and costs (x-api-units-cost-total header)

================================================================================
